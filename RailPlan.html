<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>Form → PDF + Shapes (jsPDF)</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: Canvas; color: CanvasText;
    }
    header {
      padding: 16px; border-bottom: 1px solid color-mix(in oklab, CanvasText 15%, Canvas);
    }
    main { max-width: 780px; margin: 0 auto; padding: 16px; }
    form { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    label { font-weight: 600; font-size: 0.95rem; }
    input, select, textarea, button {
      width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid color-mix(in oklab, CanvasText 15%, Canvas);
      background: color-mix(in oklab, Canvas 98%, CanvasText 2%); color: CanvasText; font-size: 1rem;
    }
    textarea { min-height: 120px; }
    .checkbox { display: flex; align-items: center; gap: 10px; }
    .actions { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 6px; }
    button { cursor: pointer; font-weight: 700; }
    .hint { font-size: 0.9rem; opacity: 0.75; }
    @media (min-width: 720px) {
      .row { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;">Form → PDF + Shapes</h1>
    <p class="hint" style="margin:6px 0 0 0;">Enter details and generate a PDF (opens in new tab). Page 2 shows shape variations.</p>
  </header>

  <main>
    <form id="detailsForm">
      <div class="row">
        <div>
          <label for="fullName">Full name</label>
          <input id="fullName" name="fullName" type="text" placeholder="e.g. Wes Thomas" required />
        </div>
        <div>
          <label for="date">Date</label>
          <input id="date" name="date" type="date" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="department">Department</label>
          <select id="department" name="department">
            <option value="">— Select —</option>
            <option>Operations</option>
            <option>Engineering</option>
            <option>Logistics</option>
            <option>HSE</option>
          </select>
        </div>
        <div>
          <label for="role">Role</label>
          <select id="role" name="role">
            <option value="">— Select —</option>
            <option>Technician</option>
            <option>Team Lead</option>
            <option>Manager</option>
            <option>Director</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="reference">Reference #</label>
          <input id="reference" name="reference" type="text" placeholder="e.g. STS-2025-081" />
        </div>
        <div>
          <label for="priority">Priority</label>
          <select id="priority" name="priority">
            <option>Low</option>
            <option selected>Medium</option>
            <option>High</option>
            <option>Critical</option>
          </select>
        </div>
      </div>

      <div>
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="Additional details..."></textarea>
      </div>

      <div class="checkbox">
        <input id="confirm" type="checkbox" />
        <label for="confirm" style="font-weight:500;">I confirm the above details are accurate</label>
      </div>

      <div class="actions">
        <button id="generateBtn" type="button">Generate PDF</button>
        <button id="resetBtn" type="reset">Reset</button>
        <span class="hint">PDF opens in a new tab (fallback: downloads).</span>
      </div>
    </form>
  </main>

  <!-- jsPDF from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const $ = (sel) => document.querySelector(sel);
    const val = (id) => (document.getElementById(id)?.value ?? "").trim();
    const humanDate = (iso) => {
      if (!iso) return "";
      try {
        const d = new Date(iso + "T00:00:00");
        return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
      } catch { return iso; }
    };
    function wrapText(doc, text, x, y, maxWidth, lineHeight) {
      const words = (text || "").split(/\s+/);
      let line = "", cursorY = y;
      for (let i = 0; i < words.length; i++) {
        const test = line ? line + " " + words[i] : words[i];
        const w = doc.getTextWidth(test);
        if (w > maxWidth && line) {
          doc.text(line, x, cursorY);
          line = words[i];
          cursorY += lineHeight;
        } else {
          line = test;
        }
      }
      if (line) doc.text(line, x, cursorY);
      return cursorY;
    }

    function heading(doc, text, x, y) {
      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text(text, x, y);
      doc.setDrawColor(100);
      doc.setLineWidth(0.8);
      doc.line(x, y + 6, x + 420, y + 6);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
    }

    function drawShapeLibrary(doc) {
      const pageW = doc.internal.pageSize.getWidth();
      const margin = 40;
      let x = margin, y = margin + 10;

      heading(doc, "Shape Library & Warning Sign Examples", x, y);
      y += 20;

      // Column helpers
      const colW = (pageW - margin * 2) / 2 - 10;
      const leftX = x, rightX = x + colW + 20;

      // 1) Rounded rectangles / squares
      doc.setFontSize(12);
      doc.text("Rounded Rectangles / Squares:", leftX, y);

      // Stroked rounded square
      y += 10;
      doc.setDrawColor(0);
      doc.setFillColor(255, 255, 255);
      doc.setLineWidth(2);
      doc.roundedRect(leftX, y, 60, 60, 10, 10, "S");
      doc.text("Stroke 2pt", leftX + 70, y + 32, { baseline: "middle" });

      // Filled + stroked rounded rect
      y += 75;
      doc.setDrawColor(10, 60, 200);
      doc.setFillColor(210, 228, 255);
      doc.setLineWidth(1.2);
      doc.roundedRect(leftX, y, 120, 60, 12, 12, "FD");
      doc.text("Fill + Stroke", leftX + 130, y + 30, { baseline: "middle" });

      // 2) Lines (thick / thin / dashed / dotted)
      let ry = margin + 30;
      doc.text("Lines (solid, dashed, dotted):", rightX, ry);
      ry += 10;

      // Solid thin
      doc.setDrawColor(0);
      doc.setLineWidth(0.8);
      doc.setLineDash([]); // solid
      doc.line(rightX, ry + 8, rightX + colW, ry + 8);
      doc.text("Solid 0.8pt", rightX, ry + 24);
      ry += 32;

      // Solid thick
      doc.setLineWidth(4);
      doc.line(rightX, ry + 8, rightX + colW, ry + 8);
      doc.setLineWidth(0.8);
      doc.text("Solid 4pt", rightX, ry + 24);
      ry += 32;

      // Dashed
      doc.setLineDash([8, 6], 0);
      doc.line(rightX, ry + 8, rightX + colW, ry + 8);
      doc.setLineDash([]); // reset
      doc.text("Dashed [8,6]", rightX, ry + 24);
      ry += 32;

      // Dotted (short dash/gap)
      doc.setLineDash([1, 5], 0);
      doc.line(rightX, ry + 8, rightX + colW, ry + 8);
      doc.setLineDash([]);
      doc.text("Dotted [1,5]", rightX, ry + 24);
      ry += 40;

      // 3) Circles / Ellipses
      y += 95;
      doc.text("Circles / Ellipses:", leftX, y);
      y += 8;

      // Circle (filled yellow, black stroke)
      doc.setDrawColor(0);
      doc.setFillColor(255, 220, 0);
      doc.setLineWidth(2);
      doc.circle(leftX + 30, y + 30, 30, "FD");
      doc.text("Circle: Fill Yellow + Black Stroke", leftX + 70, y + 30, { baseline: "middle" });

      // Ellipse (red outline)
      y += 70;
      doc.setDrawColor(200, 20, 20);
      doc.setLineWidth(2);
      doc.ellipse(leftX + 40, y + 25, 40, 25, "S");
      doc.text("Ellipse: Red Stroke", leftX + 100, y + 25, { baseline: "middle" });

      // 4) Triangles (warning sign base)
      doc.text("Triangles:", rightX, ry);
      ry += 10;

      // Equilateral triangle (stroke)
      const triY = ry;
      const tSize = 60;
      const tX = rightX + 20;
      const h = tSize * Math.sqrt(3) / 2;
      doc.setDrawColor(0);
      doc.setLineWidth(2);
      doc.triangle(tX, triY + h, tX + tSize / 2, triY, tX + tSize, triY + h, "S");
      doc.text("Equilateral Triangle (stroke)", tX + tSize + 10, triY + h / 2, { baseline: "middle" });
      ry += h + 22;

      // Filled red triangle
      const t2Y = ry;
      doc.setDrawColor(160, 0, 0);
      doc.setFillColor(255, 200, 200);
      doc.triangle(tX, t2Y + h, tX + tSize / 2, t2Y, tX + tSize, t2Y + h, "FD");
      doc.text("Filled Triangle (red stroke, light fill)", tX + tSize + 10, t2Y + h / 2, { baseline: "middle" });
      ry += h + 28;

      // 5) Pre-styled examples (warning signs)
      y += 70;
      heading(doc, "Pre-styled Warning Sign Examples", x, y);
      y += 20;

      // A) Yellow warning triangle with black border + exclamation
      const wx = x;
      const wy = y;
      const base = 100;
      const hh = base * Math.sqrt(3) / 2;
      doc.setFillColor(255, 230, 0); // yellow
      doc.setDrawColor(0); // black
      doc.setLineWidth(4);
      doc.triangle(wx, wy + hh, wx + base / 2, wy, wx + base, wy + hh, "FD");
      // Inner white exclamation
      doc.setFont("helvetica", "bold");
      doc.setTextColor(0);
      doc.setFontSize(58);
      doc.text("!", wx + base / 2, wy + hh * 0.72, { align: "center", baseline: "middle" });
      doc.setTextColor(0);
      doc.setFontSize(12);
      doc.text("⚠️ Standard Warning Triangle", wx + base + 16, wy + hh / 2, { baseline: "middle" });

      // B) Rounded square prohibition style (red ring)
      const bx = x + 220;
      const by = y - 4;
      doc.setDrawColor(0);
      doc.setFillColor(255, 255, 255);
      doc.setLineWidth(2);
      doc.roundedRect(bx, by, 110, 110, 14, 14, "FD");
      // Red ring
      doc.setDrawColor(200, 0, 0);
      doc.setLineWidth(10);
      doc.circle(bx + 55, by + 55, 38, "S");
      // Red slash
      doc.setLineWidth(12);
      doc.setLineCap("round");
      doc.line(bx + 25, by + 85, bx + 85, by + 25);
      // Label
      doc.setLineWidth(1);
      doc.setDrawColor(0);
      doc.setFontSize(12);
      doc.text("Prohibition (blank center)", bx + 130, by + 55, { baseline: "middle" });

      // C) Circular mandatory sign (blue fill, white pictogram placeholder)
      const cx = x + 420;
      const cy = y + 2;
      doc.setFillColor(40, 120, 235); // blue
      doc.setDrawColor(0);
      doc.setLineWidth(2);
      doc.circle(cx + 55, cy + 55, 55, "FD");
      // White placeholder pictogram (rounded rect bar)
      doc.setFillColor(255, 255, 255);
      doc.roundedRect(cx + 30, cy + 50, 50, 10, 5, 5, "F");
      doc.setFontSize(12);
      doc.setTextColor(0);
      doc.text("Mandatory (placeholder pictogram)", cx + 120, cy + 55, { baseline: "middle" });
    }

    $("#generateBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });

      // Collect form values
      const data = {
        fullName: val("fullName"),
        date: humanDate(val("date")),
        department: val("department"),
        role: val("role"),
        reference: val("reference"),
        priority: val("priority"),
        notes: val("notes"),
        confirmed: $("#confirm").checked ? "Yes" : "No",
        generatedAt: new Date().toLocaleString()
      };

      // ---- Page 1: Form Summary ----
      const margin = 48;
      let x = margin, y = margin;
      doc.setFont("helvetica", "bold");
      doc.setFontSize(20);
      doc.text("Form Submission Summary", x, y);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text(`Generated: ${data.generatedAt}`, x, y + 16);

      y += 32;
      doc.setDrawColor(120);
      doc.roundedRect(margin, y, doc.internal.pageSize.getWidth() - margin * 2, 220, 8, 8);

      const left = x + 12;
      const right = doc.internal.pageSize.getWidth() / 2 + 12;
      let ly = y + 24;
      let ry = y + 24;

      doc.setFontSize(12);
      function field(label, value, toRight = false) {
        const tx = toRight ? right : left;
        const ty = toRight ? ry : ly;
        doc.setFont("helvetica", "bold");
        doc.text(label, tx, ty);
        doc.setFont("helvetica", "normal");
        doc.text(value || "—", tx, ty + 16);
        if (toRight) { ry += 40; } else { ly += 40; }
      }

      field("Full name", data.fullName);
      field("Date", data.date);
      field("Department", data.department, true);
      field("Role", data.role, true);
      field("Reference #", data.reference);
      field("Priority", data.priority, true);
      field("Confirmed", data.confirmed);

      const notesTop = Math.max(ly, ry) + 8;
      doc.setFont("helvetica", "bold");
      doc.text("Notes", left, notesTop);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      const finalY = wrapText(
        doc,
        data.notes || "—",
        left,
        notesTop + 18,
        doc.internal.pageSize.getWidth() - margin * 2 - 24,
        16
      );

      const footerY = Math.max(finalY + 24, doc.internal.pageSize.getHeight() - 48);
      doc.setFontSize(9);
      doc.setTextColor(120);
      doc.text("Generated by Form → PDF demo", margin, footerY);

      // ---- Page 2: Shapes & Examples ----
      doc.addPage();
      drawShapeLibrary(doc);

      // Open in new tab (fallback to download)
      try {
        const blobUrl = doc.output("bloburl");
        const win = window.open(blobUrl, "_blank");
        if (!win) {
          doc.save(`Form-${(data.reference || "Unnamed")}.pdf`);
        }
      } catch (e) {
        console.error(e);
        doc.save(`Form-${(data.reference || "Unnamed")}.pdf`);
      }
    });

    // Autofill date with today
    (function prefill() {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const dateEl = $("#date");
      if (dateEl && !dateEl.value) dateEl.value = `${yyyy}-${mm}-${dd}`;
    })();
  </script>
</body>
</html>