<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>Form → PDF (jsPDF)</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: Canvas; color: CanvasText;
    }
    header {
      padding: 16px; border-bottom: 1px solid color-mix(in oklab, CanvasText 15%, Canvas);
    }
    main { max-width: 780px; margin: 0 auto; padding: 16px; }
    form {
      display: grid; gap: 12px;
      grid-template-columns: 1fr;
    }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    label { font-weight: 600; font-size: 0.95rem; }
    input, select, textarea, button {
      width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid color-mix(in oklab, CanvasText 15%, Canvas);
      background: color-mix(in oklab, Canvas 98%, CanvasText 2%); color: CanvasText; font-size: 1rem;
    }
    textarea { min-height: 120px; }
    .inline {
      display: grid; gap: 12px;
      grid-template-columns: 1fr 1fr;
    }
    .checkbox {
      display: flex; align-items: center; gap: 10px;
    }
    .actions {
      display: flex; gap: 12px; flex-wrap: wrap; margin-top: 6px;
    }
    button {
      cursor: pointer; font-weight: 700;
    }
    .hint { font-size: 0.9rem; opacity: 0.75; }
    @media (min-width: 720px) {
      .row { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;">Form → PDF demo</h1>
    <p class="hint" style="margin:6px 0 0 0;">Enter a few details and generate a PDF in a new tab.</p>
  </header>

  <main>
    <form id="detailsForm">
      <div class="row">
        <div>
          <label for="fullName">Full name</label>
          <input id="fullName" name="fullName" type="text" placeholder="e.g. Wes Thomas" required />
        </div>
        <div>
          <label for="date">Date</label>
          <input id="date" name="date" type="date" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="department">Department</label>
          <select id="department" name="department">
            <option value="">— Select —</option>
            <option>Operations</option>
            <option>Engineering</option>
            <option>Logistics</option>
            <option>HSE</option>
          </select>
        </div>
        <div>
          <label for="role">Role</label>
          <select id="role" name="role">
            <option value="">— Select —</option>
            <option>Technician</option>
            <option>Team Lead</option>
            <option>Manager</option>
            <option>Director</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="reference">Reference #</label>
          <input id="reference" name="reference" type="text" placeholder="e.g. STS-2025-081" />
        </div>
        <div>
          <label for="priority">Priority</label>
          <select id="priority" name="priority">
            <option>Low</option>
            <option selected>Medium</option>
            <option>High</option>
            <option>Critical</option>
          </select>
        </div>
      </div>

      <div>
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="Additional details..."></textarea>
      </div>

      <div class="checkbox">
        <input id="confirm" type="checkbox" />
        <label for="confirm" style="font-weight:500;">I confirm the above details are accurate</label>
      </div>

      <div class="actions">
        <button id="generateBtn" type="button">Generate PDF</button>
        <button id="resetBtn" type="reset">Reset</button>
        <span class="hint">PDF opens in a new tab (fallback: downloads).</span>
      </div>
    </form>
  </main>

  <!-- jsPDF from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    // Small utility for safe text extraction
    const $ = (sel) => document.querySelector(sel);
    function val(id) { return (document.getElementById(id)?.value ?? "").trim(); }
    function humanDate(iso) {
      if (!iso) return "";
      try {
        const d = new Date(iso + "T00:00:00");
        return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
      } catch { return iso; }
    }
    function wrapText(doc, text, x, y, maxWidth, lineHeight) {
      const words = text.split(/\s+/);
      let line = "";
      let cursorY = y;
      for (let i = 0; i < words.length; i++) {
        const test = line ? line + " " + words[i] : words[i];
        const w = doc.getTextWidth(test);
        if (w > maxWidth && line) {
          doc.text(line, x, cursorY);
          line = words[i];
          cursorY += lineHeight;
        } else {
          line = test;
        }
      }
      if (line) doc.text(line, x, cursorY);
      return cursorY;
    }

    $("#generateBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });

      // Gather values
      const data = {
        fullName: val("fullName"),
        date: humanDate(val("date")),
        department: val("department"),
        role: val("role"),
        reference: val("reference"),
        priority: val("priority"),
        notes: val("notes"),
        confirmed: $("#confirm").checked ? "Yes" : "No",
        generatedAt: new Date().toLocaleString()
      };

      // --- Simple layout ---
      const margin = 48;
      let x = margin, y = margin;

      // Header
      doc.setFont("helvetica", "bold");
      doc.setFontSize(20);
      doc.text("Form Submission Summary", x, y);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text(`Generated: ${data.generatedAt}`, x, y + 16);

      // Box
      y += 32;
      doc.setDrawColor(120); // subtle border
      doc.roundedRect(margin, y, doc.internal.pageSize.getWidth() - margin * 2, 220, 8, 8);

      // Content
      const left = x + 12;
      const right = doc.internal.pageSize.getWidth() / 2 + 12;
      let ly = y + 24;
      let ry = y + 24;

      doc.setFontSize(12);
      function field(label, value, toRight = false) {
        const tx = toRight ? right : left;
        const ty = toRight ? ry : ly;
        doc.setFont("helvetica", "bold");
        doc.text(label, tx, ty);
        doc.setFont("helvetica", "normal");
        doc.text(value || "—", tx, ty + 16);
        if (toRight) { ry += 40; } else { ly += 40; }
      }

      field("Full name", data.fullName);
      field("Date", data.date);
      field("Department", data.department, true);
      field("Role", data.role, true);
      field("Reference #", data.reference);
      field("Priority", data.priority, true);
      field("Confirmed", data.confirmed);

      // Notes (full-width block)
      const notesTop = Math.max(ly, ry) + 8;
      doc.setFont("helvetica", "bold");
      doc.text("Notes", left, notesTop);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      const finalY = wrapText(
        doc,
        data.notes || "—",
        left,
        notesTop + 18,
        doc.internal.pageSize.getWidth() - margin * 2 - 24,
        16
      );

      // Footer
      const footerY = Math.max(finalY + 24, doc.internal.pageSize.getHeight() - 48);
      doc.setFontSize(9);
      doc.setTextColor(120);
      doc.text("Generated by Form → PDF demo", margin, footerY);

      // Open in a new tab (with a safe fallback)
      try {
        const blobUrl = doc.output("bloburl");
        const win = window.open(blobUrl, "_blank");
        if (!win) {
          // Fallback: prompt download if popup blocked
          doc.save(`Form-${(data.reference || "Unnamed")}.pdf`);
        }
      } catch (e) {
        console.error(e);
        doc.save(`Form-${(data.reference || "Unnamed")}.pdf`);
      }
    });

    // Optional: prefill date with today for convenience
    (function prefill() {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const dateEl = $("#date");
      if (dateEl && !dateEl.value) dateEl.value = `${yyyy}-${mm}-${dd}`;
    })();
  </script>
</body>
</html>