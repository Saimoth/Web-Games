<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mortgage & Pension Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 10px; background: #fafcff; }
        .tabs { display: flex; cursor: pointer; }
        .tab { flex:1; padding: 16px 0; text-align: center; font-size: 1.3em; border: 2px solid #0072c6; border-bottom: none; background: #e6f1fb; }
        .tab.active { background: #fff; font-weight: bold; color: #0072c6; }
        .tab-content { border: 2px solid #0072c6; border-top: none; padding: 22px; background: #fff; border-radius: 0 0 8px 8px; }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
            font-size: 1.1em;
            flex-wrap: nowrap;
        }
        .form-group label {
            min-width: 130px;
            margin-right: 8px;
            margin-bottom: 0;
            white-space: nowrap;
        }
        .form-group input[type="number"], 
        .form-group input[type="text"] {
            width: 90px;
            margin-right: 5px;
            margin-bottom: 0;
            padding: 10px;
            font-size: 1.06em;
            border-radius: 6px;
            border: 1.5px solid #b0c8e0;
        }
        .years-months { width: 45px !important; }
        .years { width: 55px !important; }
        .form-group input[type="checkbox"] { width: 20px; height: 20px; margin-right: 6px; }
        .unit {
            margin-left: 2px;
            margin-right: 20px;
            white-space: nowrap;
            font-size: 0.98em;
            color: #456;
        }
        .stacked-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .stacked-input-row, .repayment-input-row {
            margin-left: 27px;
            margin-top: 5px;
            display: flex;
            align-items: center;
        }
        button {
            padding: 14px 0; font-size: 1.15em; width: 100%;
            background: #0072c6; color: #fff; border: none; border-radius: 7px; font-weight: bold; margin-top: 10px;
        }
        #results-section, #pension-results-section { margin-top: 30px; }
        #monthly-payment { font-size:1.13em; margin-bottom: 18px; }
        #chart-container, #pension-chart-container { width: 100%; max-width: 99vw; height: 250px; margin: 0 auto 30px auto; }
        #log, #pension-log { background: #f7fafd; border: 1.5px solid #cce1f7; border-radius: 8px; max-height: 190px; overflow-y: auto; padding: 18px; font-size: 0.97em; }
        #pension-summary { font-size:1.12em; margin-bottom: 18px; }
        @media (max-width: 600px) {
            .tab, button { font-size: 1em; }
            .tab-content, #log, #pension-log { padding: 10px; }
            #chart-container, #pension-chart-container { height: 170px; }
            .form-group { flex-wrap: wrap; font-size: 1em;}
            .form-group label, .form-group .unit { min-width: unset; margin-bottom: 4px; }
            .stacked-input-row, .repayment-input-row { margin-left: 0; }
        }
    </style>
</head>
<body>

<div class="tabs">
    <div class="tab active" onclick="showTab('mortgage')">Mortgage</div>
    <div class="tab" onclick="showTab('pension')">Pension</div>
</div>

<!-- Mortgage Tab -->
<div class="tab-content" id="mortgage-tab">
    <h2 style="font-size:1.5em;">Mortgage Calculator</h2>
    <div class="form-group">
        <label for="mortgage-amount">£ Borrowed:</label>
        <input type="number" id="mortgage-amount" value="250000" min="0" step="1000">
        <span class="unit">pounds</span>
    </div>
    <div class="form-group">
        <label for="mortgage-rate">Interest Rate:</label>
        <input type="number" id="mortgage-rate" value="4" min="0" step="0.01">
        <span class="unit">% per year</span>
    </div>
    <div class="form-group" style="flex-direction: column; align-items: flex-start;">
        <label for="mortgage-years" style="min-width:unset;">Repayment Period:</label>
        <div class="repayment-input-row">
            <input type="number" class="years-months" id="mortgage-years" value="25" min="0" step="1">
            <span class="unit">years</span>
            <input type="number" class="years-months" id="mortgage-months" value="0" min="0" max="11" step="1">
            <span class="unit">months</span>
        </div>
    </div>
    <div class="form-group stacked-group">
        <div>
            <input type="checkbox" id="overpayment-check" onchange="toggleOverpayment()">
            <label for="overpayment-check" style="margin-right:8px;">Include Overpayment?</label>
        </div>
        <div class="stacked-input-row">
            <input type="number" id="overpayment-amount" value="200" min="0" step="10" disabled>
            <span class="unit">per month</span>
        </div>
    </div>
    <div class="form-group stacked-group">
        <div>
            <input type="checkbox" id="inflation-check" onchange="toggleInflation()">
            <label for="inflation-check" style="margin-right:8px;">Include Inflation?</label>
        </div>
        <div class="stacked-input-row">
            <input type="number" id="inflation-percent" value="3" min="0" max="100" step="0.1" disabled>
            <span class="unit">% per year</span>
        </div>
    </div>
    <button onclick="calculateMortgage()">Calculate</button>
    <div id="results-section" style="display:none;">
        <div id="summary" style="font-size:1.13em; margin-bottom:12px;"></div>
        <div id="monthly-payment"></div>
        <div id="chart-container">
            <canvas id="mortgage-chart"></canvas>
        </div>
        <div>
            <strong>Repayment Log (every 3 months):</strong>
            <div id="log"></div>
        </div>
    </div>
</div>

<!-- Pension Tab -->
<div class="tab-content" id="pension-tab" style="display:none;">
    <h2 style="font-size:1.5em;">Pension Estimator</h2>
    <div class="form-group">
        <label for="pension-current">Current Value:</label>
        <input type="number" id="pension-current" value="0" min="0" step="100">
        <span class="unit">pounds</span>
    </div>
    <div class="form-group">
        <label for="pension-wage">Wage:</label>
        <input type="number" id="pension-wage" value="50000" min="0" step="100">
        <span class="unit">pounds/year</span>
    </div>
    <div class="form-group">
        <label for="pension-wage-contri">Wage Contribution:</label>
        <input type="number" id="pension-wage-contri" value="8" min="0" max="100" step="0.1">
        <span class="unit">% of wage</span>
    </div>
    <div class="form-group">
        <label for="pension-employer-contri">Employer Contribution:</label>
        <input type="number" id="pension-employer-contri" value="8" min="0" max="100" step="0.1">
        <span class="unit">% of wage</span>
    </div>
    <div class="form-group stacked-group">
        <div>
            <input type="checkbox" id="pension-wagerise-check" onchange="toggleWageRise()">
            <label for="pension-wagerise-check" style="margin-right:8px;">Include Wage Rise?</label>
        </div>
        <div class="stacked-input-row">
            <input type="number" id="pension-wagerise-percent" value="3" min="0" max="100" step="0.1" disabled>
            <span class="unit">% per year</span>
        </div>
    </div>
    <div class="form-group">
        <label for="pension-growth">Average Annual Growth Rate:</label>
        <input type="number" id="pension-growth" value="5" min="0" max="100" step="0.1">
        <span class="unit">% per year</span>
    </div>
    <div class="form-group">
        <label for="pension-term">Term Period:</label>
        <input type="number" class="years" id="pension-term" value="20" min="1" max="70" step="1">
        <span class="unit">years</span>
    </div>
    <button onclick="calculatePension()">Calculate</button>
    <div id="pension-results-section" style="display:none;">
        <div id="pension-summary"></div>
        <div id="pension-chart-container">
            <canvas id="pension-chart"></canvas>
        </div>
        <div>
            <strong>Yearly Log:</strong>
            <div id="pension-log"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// --- TAB HANDLING ---
function showTab(tabName) {
    document.getElementById('mortgage-tab').style.display = (tabName === 'mortgage') ? '' : 'none';
    document.getElementById('pension-tab').style.display = (tabName === 'pension') ? '' : 'none';
    var tabs = document.getElementsByClassName('tab');
    for(let i=0; i<tabs.length; i++) tabs[i].classList.remove('active');
    if(tabName === 'mortgage') tabs[0].classList.add('active');
    else tabs[1].classList.add('active');
}
// --- MORTGAGE ---
function toggleOverpayment() {
    var check = document.getElementById('overpayment-check');
    var input = document.getElementById('overpayment-amount');
    input.disabled = !check.checked;
}
function toggleInflation() {
    var check = document.getElementById('inflation-check');
    var input = document.getElementById('inflation-percent');
    input.disabled = !check.checked;
}
function calculateMortgage() {
    // Inputs
    const principal = parseFloat(document.getElementById('mortgage-amount').value);
    const annualRate = parseFloat(document.getElementById('mortgage-rate').value) / 100;
    const years = parseInt(document.getElementById('mortgage-years').value);
    const months = parseInt(document.getElementById('mortgage-months').value);
    const periodMonths = years * 12 + months;
    const overpayChecked = document.getElementById('overpayment-check').checked;
    const inflationChecked = document.getElementById('inflation-check').checked;
    let overpay = overpayChecked ? parseFloat(document.getElementById('overpayment-amount').value) : 0;
    let inflation = inflationChecked ? parseFloat(document.getElementById('inflation-percent').value) : 0;
    const monthlyRate = annualRate / 12;

    let baseMonthlyPayment = (monthlyRate === 0)
        ? (principal / periodMonths)
        : (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -periodMonths));

    let currentMonthlyPayment = baseMonthlyPayment;
    let currentOverpay = overpayChecked ? overpay : 0;
    const initialTotalPayment = currentMonthlyPayment + currentOverpay; // initial payment, month 1

    let balance = principal, totalPaid = 0, totalInterest = 0;
    let log = [], chartData = [], labels = [];
    let month = 0;
    let finalPayment = initialTotalPayment;

    while (balance > 0.01 && month < 1000 * 12) {
        // Increase both monthly repayment and overpayment every 12 months if inflation enabled
        if (inflationChecked && month > 0 && month % 12 === 0) {
            currentMonthlyPayment += currentMonthlyPayment * (inflation / 100);
            currentOverpay += currentOverpay * (inflation / 100);
        }
        let payment = Math.min(currentMonthlyPayment + currentOverpay, balance + balance * monthlyRate);
        if (payment > finalPayment) finalPayment = payment;
        let interest = balance * monthlyRate;
        let principalPaid = payment - interest;
        if (principalPaid > balance) principalPaid = balance;
        balance -= principalPaid;
        totalPaid += payment;
        totalInterest += interest;
        chartData.push(balance < 0 ? 0 : balance);
        labels.push('Month ' + (month + 1));
        if (month % 3 === 0 || balance < 0.01) {
            log.push(`Month ${month+1}: Balance £${balance.toFixed(2)}, Payment £${payment.toFixed(2)}, Paid £${totalPaid.toFixed(2)}, Interest £${totalInterest.toFixed(2)}`);
        }
        month++;
    }

    let monthlyHtml = `
        <b>Initial Monthly Repayment (inc. overpayment):</b> £${initialTotalPayment.toLocaleString(undefined, {maximumFractionDigits:2})}<br>
        <b>Final Monthly Repayment (inc. overpayment and inflation):</b> £${finalPayment.toLocaleString(undefined, {maximumFractionDigits:2})}
    `;
    document.getElementById('monthly-payment').innerHTML = monthlyHtml;

    let summary = `
        <b>Total months to repay:</b> ${month} <br>
        <b>Total years:</b> ${(month/12).toFixed(2)} <br>
        <b>Total paid:</b> £${totalPaid.toLocaleString(undefined,{maximumFractionDigits:2})} <br>
        <b>Total interest paid:</b> £${totalInterest.toLocaleString(undefined,{maximumFractionDigits:2})}
    `;
    document.getElementById('summary').innerHTML = summary;
    document.getElementById('results-section').style.display = '';
    document.getElementById('log').innerHTML = log.join('<br>');

    // Graph X labels: only 10 labels (evenly spaced), grid every year
    if(window.mortgageChartObj) window.mortgageChartObj.destroy();
    const ctx = document.getElementById('mortgage-chart').getContext('2d');
    const totalYears = Math.ceil(periodMonths / 12);
    const monthsPerLabel = Math.max(1, Math.round(periodMonths / 10));
    window.mortgageChartObj = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Outstanding Balance (£)',
                data: chartData,
                borderWidth: 3,
                fill: false,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display:true, text:'Balance (£)' } },
                x: { 
                    title: { display: true, text: 'Years' },
                    grid: {
                        drawOnChartArea: true,
                        color: function(context) {
                            if (context.tick && context.tick.value % 12 === 0) {
                                return '#bbb';
                            }
                            return 'transparent';
                        }
                    },
                    ticks: {
                        autoSkip: false,
                        maxRotation: 0,
                        minRotation: 0,
                        callback: function(value, index) {
                            // Show only 10 evenly spaced labels including start and end
                            const totalMonths = periodMonths;
                            const steps = 9;
                            let positions = [];
                            for (let i = 0; i <= steps; i++) {
                                positions.push(Math.round(i * totalMonths / steps));
                            }
                            if (positions.includes(index)) {
                                return (index / 12).toFixed(0);
                            }
                            return '';
                        }
                    }
                }
            }
        }
    });
}
toggleOverpayment();
toggleInflation();

// --- PENSION ---
function toggleWageRise() {
    var check = document.getElementById('pension-wagerise-check');
    var input = document.getElementById('pension-wagerise-percent');
    input.disabled = !check.checked;
}
function calculatePension() {
    let currentValue = parseFloat(document.getElementById('pension-current').value) || 0;
    let wage = parseFloat(document.getElementById('pension-wage').value) || 0;
    let wageContri = parseFloat(document.getElementById('pension-wage-contri').value) / 100;
    let employerContri = parseFloat(document.getElementById('pension-employer-contri').value) / 100;
    let includeWageRise = document.getElementById('pension-wagerise-check').checked;
    let wageRise = includeWageRise ? (parseFloat(document.getElementById('pension-wagerise-percent').value) / 100) : 0;
    let avgGrowth = parseFloat(document.getElementById('pension-growth').value) / 100;
    let term = parseInt(document.getElementById('pension-term').value);

    // Prepare for three growth rates
    let rates = [
        { name: "Worse", value: avgGrowth - 0.02 },
        { name: "Expected", value: avgGrowth },
        { name: "Better", value: avgGrowth + 0.02 }
    ];
    let logs = [[], [], []], values = [currentValue, currentValue, currentValue];
    let series = [[], [], []];

    let currWage = wage;

    for (let year = 1; year <= term; year++) {
        let annualContri = currWage * (wageContri + employerContri);
        for (let i = 0; i < 3; i++) {
            // Apply growth to current value before contribution
            values[i] *= (1 + rates[i].value);
            values[i] += annualContri;
            series[i].push(values[i]);
            logs[i].push(`Year ${year}: Value £${values[i].toLocaleString(undefined, {maximumFractionDigits:2})}, Contributed £${annualContri.toLocaleString(undefined, {maximumFractionDigits:2})}, Growth rate ${(rates[i].value*100).toFixed(2)}%`);
        }
        if (includeWageRise) currWage *= (1 + wageRise);
    }

    // Prepare summary
    let summaryHtml = `
      <b>After ${term} years you may have:</b><br>
      <b>Worse (${((avgGrowth-0.02)*100).toFixed(2)}% growth):</b> £${values[0].toLocaleString(undefined, {maximumFractionDigits:2})}<br>
      <b>Expected (${(avgGrowth*100).toFixed(2)}% growth):</b> £${values[1].toLocaleString(undefined, {maximumFractionDigits:2})}<br>
      <b>Better (${((avgGrowth+0.02)*100).toFixed(2)}% growth):</b> £${values[2].toLocaleString(undefined, {maximumFractionDigits:2})}<br>
    `;
    document.getElementById('pension-summary').innerHTML = summaryHtml;
    document.getElementById('pension-results-section').style.display = '';
    // Yearly log (expected growth)
    document.getElementById('pension-log').innerHTML = logs[1].join('<br>');

    // Chart X labels: only 10 evenly spaced labels, grid every year
    if(window.pensionChartObj) window.pensionChartObj.destroy();
    const ctx = document.getElementById('pension-chart').getContext('2d');
    const years = term;
    const steps = 9; // for 10 labels
    let labelPositions = [];
    for (let i = 0; i <= steps; i++) {
        labelPositions.push(Math.round(i * (years-1) / steps));
    }
    window.pensionChartObj = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: years}, (_, i) => 'Year ' + (i+1)),
            datasets: [
                {
                    label: 'Worse',
                    data: series[0],
                    borderWidth: 2,
                    borderDash: [6,4],
                    fill: false,
                    pointRadius: 0
                },
                {
                    label: 'Expected',
                    data: series[1],
                    borderWidth: 3,
                    fill: false,
                    pointRadius: 0
                },
                {
                    label: 'Better',
                    data: series[2],
                    borderWidth: 2,
                    borderDash: [6,4],
                    fill: false,
                    pointRadius: 0
                }
            ]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: {
                y: { beginAtZero: true, title: { display:true, text:'Pension Value (£)' } },
                x: { 
                    title: { display: true, text: 'Years' },
                    grid: {
                        drawOnChartArea: true,
                        color: function(context) {
                            // Draw grid line every year
                            if (context.tick && context.tick.value % 1 === 0) {
                                return '#bbb';
                            }
                            return 'transparent';
                        }
                    },
                    ticks: {
                        autoSkip: false,
                        maxRotation: 0,
                        minRotation: 0,
                        callback: function(value, index) {
                            // Only show label at 10 evenly spaced years
                            if (labelPositions.includes(index)) {
                                return (index+1);
                            }
                            return '';
                        }
                    }
                }
            }
        }
    });
}
toggleWageRise();
</script>
</body>
</html>